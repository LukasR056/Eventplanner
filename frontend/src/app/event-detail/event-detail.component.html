<div class="eventanzeige">

  <mat-card class="event-card" *ngIf="event">

    <mat-card-header>
      <mat-card-title>{{event.name}}</mat-card-title>

        <button style="width: 20%; background-color: darkorange; color: white" mat-button
                *ngIf="event.eventplanner==userId" (click)="updateEvent(event.id)">Update
        </button>
      <div *ngIf="event.public">
        <button mat-icon-button shareButton="whatsapp"
                [description]="'Have you heard about this event?' ">
          <img src="https://img.icons8.com/color/32/000000/whatsapp.png">
        </button>
        <button mat-icon-button shareButton="twitter"
                [description]="'Have you heard about this event?'">
          <img src="https://img.icons8.com/color/32/000000/twitter-squared.png">
        </button>
        <button mat-icon-button shareButton="email"
                [description]="'Have you heard about this event?'">
          <mat-icon>mail</mat-icon>
        </button>

        <button mat-icon-button shareButton="print">
          <mat-icon>print</mat-icon>
        </button>
      </div>
    </mat-card-header>
    <p *ngFor="let picture of pictures">

      pic: <img src="api/media/{{picture}}" height="100px"><br>
    </p>
    <hr>
    <mat-card-content>

      <p>
        Description: {{event.description}}
      </p>
      <p>
        Location: {{event.location}}
      </p>
      <p>
        When: {{event.datetime}}
      </p>
      <p>
        Is it public: {{event.public}}
      </p>
      <p>
        Responsible: {{event.eventplanner}}
      </p>
      <p>
        Invited: {{event.invited}}
      </p>
    </mat-card-content>
  </mat-card>


  <mat-divider></mat-divider>

  <button class="add-task-button" mat-button (click)="createTask(event)">Create new Task</button>
  <!--All Tasks -->

  <!-- ------------------------------------------------------------------------------------------------------------- -->


  <div class="task-status">
    <div class="task-status-inner">
      <div class="task-status-text">To Do</div>
      <div cdkDropList id="listToDo" [cdkDropListData]="tasksOpen" (cdkDropListDropped)="saveDroppedItem($event)"
           [cdkDropListConnectedTo]="['listInProgress', 'listDone']"
           class="drop-list-height">
        <div cdkDrag [cdkDragData]="task" *ngFor="let task of tasksOpen"
             [cdkDragDisabled]="userId!=task.responsible.id && userId!=event.eventplanner">
          <mat-expansion-panel class="task-margin">
            <mat-expansion-panel-header
              [ngStyle]="{'background-color': (userId!=task.responsible.id && userId!=event.eventplanner) ? '#9b9b9b' : null }">
              <!-- WÜRDE AUCH GEHEN ABER GIBT KOMISCHEN HOVER ZURÜCK
              <mat-expansion-panel-header [ngClass]="{'task-not-dragable': (username!=task.responsible)}"> -->

              <mat-panel-title class="panel-header-width">
                <strong>{{task.title}}</strong> <br>
              </mat-panel-title>
              <mat-panel-description class="panel-header-width">
                Responsible: {{task.responsible.username}}
              </mat-panel-description>
            </mat-expansion-panel-header>
            <p>
              Description: {{task.description}}
            </p>
            <p>
              Deadline: {{task.deadline_date | date:'dd. MMM yyyy'}} {{task.deadline_time.substring(0, 5)}}
            </p>
          </mat-expansion-panel>
        </div>
      </div>
    </div>
  </div>

  <div class="task-status">
    <div class="task-status-inner">
      <div class="task-status-text">In Progress</div>
      <div cdkDropList id="listInProgress" [cdkDropListData]="tasksInProgress"
           (cdkDropListDropped)="saveDroppedItem($event)"
           [cdkDropListConnectedTo]="['listToDo', 'listDone']"
           class="drop-list-height">
        <div *ngFor="let task of tasksInProgress" cdkDrag [cdkDragData]="task"
             [cdkDragDisabled]="userId!=task.responsible.id && userId!=event.eventplanner">
          <mat-expansion-panel class="task-margin">
            <mat-expansion-panel-header
              [ngStyle]="{'background-color': (userId!=task.responsible.id && userId!=event.eventplanner) ? '#9b9b9b' : null }">
              <mat-panel-title class="panel-header-width">
                <strong>{{task.title}}</strong> <br>
              </mat-panel-title>
              <mat-panel-description class="panel-header-width">
                Responsible: {{task.responsible.username}}
              </mat-panel-description>
            </mat-expansion-panel-header>
            <p>
              Description: {{task.description}}
            </p>
            <p>
              Deadline: {{task.deadline_date | date:'dd. MMM yyyy'}} {{task.deadline_time.substring(0, 5)}}
            </p>
          </mat-expansion-panel>
        </div>
      </div>
    </div>
  </div>

  <div class="task-status">
    <div class="task-status-inner">
      <div class="task-status-text">Done</div>
      <div cdkDropList id="listDone" [cdkDropListData]="tasksDone" (cdkDropListDropped)="saveDroppedItem($event)"
           [cdkDropListConnectedTo]="['listToDo', 'listInProgress']"
           class="drop-list-height">
        <div cdkDrag [cdkDragData]="task" *ngFor="let task of tasksDone"
             [cdkDragDisabled]="userId!=task.responsible.id && userId!=event.eventplanner">
          <mat-expansion-panel class="task-margin">
            <mat-expansion-panel-header
              [ngStyle]="{'background-color': (userId!=task.responsible.id && userId!=event.eventplanner) ? '#9b9b9b' : null }">
              <mat-panel-title class="panel-header-width">
                <strong>{{task.title}}</strong> <br>
              </mat-panel-title>
              <mat-panel-description class="panel-header-width">
                Responsible: {{task.responsible.username}}
              </mat-panel-description>
            </mat-expansion-panel-header>
            <p>
              Description: {{task.description}}
            </p>
            <p>
              Deadline: {{task.deadline_date | date:'dd MMM yyyy'}} {{task.deadline_time.substring(0, 5)}}
            </p>
          </mat-expansion-panel>
        </div>
      </div>
    </div>
  </div>

</div>


<!-----------------------Anzeigen aller Messages -------------------------------->
<div class="messenger">
  <div class="messengerbox" #scrollMe [scrollTop]="scrollMe.scrollHeight">
    <mat-card class="message" *ngFor="let forumentry of forumentries; let i = index">
      <mat-card-content>
        <div class="current-date" *ngIf="showDateInbetweenForumentries(i)">
          <strong>{{forumentry.datetime | date:'dd. MMM yyyy'}}</strong></div>
        <!--  soll nur angezeigt werden, wenn forumentry.user == eingeloggter userid -->
        <div class="me" *ngIf="forumentry.userid == userId">
          <p>
            <strong>{{forumentry.user}}</strong>
          </p>
          <p>
            {{forumentry.content}}
          </p>
          <p style="text-align: right">
            {{forumentry.datetime | date:'hh:mm'}}
          </p>
        </div>

        <!-- message aller anderen -->

        <div class="others" *ngIf="forumentry.userid != userId">
          <p>
            <strong>{{forumentry.user}}</strong>
          </p>
          <p>
            {{forumentry.content}}
          </p>
          <p style="text-align: right">
            {{forumentry.datetime | date:'hh:mm'}}
          </p>
        </div>

      </mat-card-content>
    </mat-card>
  </div>


  <!--Neue Message -->


  <div class="new-message">
    New Message
    <form [formGroup]="forumentryFormGroup" class="forumentry-form">
      <mat-form-field>
        <input matInput type="text" placeholder="Content" formControlName="content">
      </mat-form-field>
    </form>
    <button mat-button (click)="createForumentry()">
      Send
    </button>
  </div>
</div>
